## Backrooms Minimum — что накидать в проект (бэклог)

Ниже — список идей, которые хорошо ложатся на текущую архитектуру (entity/poi/story/traps/net/audio/perf).
Формат: **(S/M/L)** — примерная сложность, и где примерно править.

---

### 1) Scanner как полноценная механика (а не просто шкала)

1. **Перегрев / батарейка / кулдаун** (M)
   - Сканер накапливает heat при активном слоте.
   - При перегреве: помехи, ложные пики, временно «глохнет».
   - Где: `src/game_debug_controls.h` (input), `src/hud.h` (индикаторы), `src/audio.h` (бипы/шум), `src/session.h` (состояние).

2. **Ложные сигналы / отражения** (M)
   - С вероятностью при низкой sanity и/или в опасности:
     - «фантомный» echo на 2–4 секунды (сдвиг направления),
     - «двойной пик».
   - Где: `src/traps.h` (echo), `src/story.h` (фазы), `src/sanity_balance.h`.

3. **Риск привлечь сущность** (M)
   - Частые бипы повышают “noise meter”; при пороге — спавн/агр ближайшей сущности.
   - Где: `src/entity_ai.h`, `src/audio.h` (состояние «шум»), `src/game_main_entry.h` (тик логики).

---

### 2) Сущности / AI (core gameplay)

1. **Smiler (новый EntityType)** (L)
   - Поведение: появляется в дальнем конце коридора при низкой sanity, “freeze when looked at”, исчезает при потере взгляда.
   - Атака: не дамажит сразу, а “ломает свет”/вызывает помехи и гонит игрока.
   - Где: `src/entity_types.h`, `src/entity.h`, `src/entity_ai.h`, `src/game_rendering_loop.h` (рендер), `src/audio.h`.

2. **Слух для Crawler (реакция на шаги/бег)** (M)
   - Использовать уже имеющийся `sndState.moveIntensity`/`sprintIntensity`.
   - Дистанция детекта и агро — от “шумности”.
   - Где: `src/entity_ai.h`, `src/audio.h`.

3. **Простой pathfinding по гриду (BFS/A*)** (L)
   - Дешёвый A* на ограниченном радиусе (например 20–30 клеток), кеширование.
   - Фолбэк: текущая логика “прямо к игроку + избегание стен”.
   - Где: `src/entity_ai.h`, `src/world.h` (доступ к клеткам).

---

### 3) Roam events / traps (контент-плотность)

1. **Light Flicker Zones (не глобально, а зонами)** (M)
   - Выделять «аномальные» чанки: внутри зоны свет ведёт себя хуже.
   - Где: `src/world.h` (seed), `src/perf_tuning.h`/`src/game_rendering_loop.h` (выбор ближайших огней), `src/shaders.h`.

2. **“Stalker Corridor”** (M)
   - Генерится короткий коридор с дверью; пока игрок внутри — дверь закрыта, спавн сущности в конце.
   - Где: `src/traps.h`, `src/world.h` (carve), `src/entity_mgr`.

3. **Loot-помещения (POI) с мини-головоломкой** (M)
   - Например: нужен “ключ-карта”/“кнопка”/“рычаг” (локальная переменная), после чего спавн 2–3 предметов.
   - Где: `src/poi_logic.h`, `src/map_content.h`, `src/hud.h`.

---

### 4) Предметы / инвентарь (экономика выживания)

1. **Мед-спрей / бинт** (S/M)
   - Восстанавливает HP; редкий.
   - Где: `src/item_types.h`, `src/coop.h` (applyItemUse), `src/poi_logic.h`, `src/content_events.h`.

2. **“Tape” (VHS) — временно снижает VHS-интенсивность** (M)
   - Дает 20–30 секунд “чистого” изображения (полезно в панике).
   - Где: `src/game_main_entry.h` (vhs), `src/hud.h`, `src/item_types.h`.

3. **Предмет «Фальшфейер»** (M)
   - Свет/дым на месте, отвлекает сущность.
   - Где: `src/entity_ai.h`, `src/world.h`/`src/render.h` (простая визуалка), `src/audio.h`.

---

### 5) Сеть / кооп

1. **Синхронизация worldItems по событиям (spawn/pickup), а не снепшотами** (M)
   - Сейчас удобнее, но тратит трафик.
   - Добавить пакеты: ITEM_SPAWN / ITEM_PICK.
   - Где: `shared/protocol`, `src/net_packets.h`, `src/net_core.h`, `src/coop.h`.

2. **“Ping” метка от игрока** (S)
   - В коопе: поставить маркер на миникарте / на экране.
   - Где: `src/minimap.h`, `src/net_packets.h`, `src/hud.h`.

---

### 6) UX / Debug / инструменты

1. **Тестовый “scenario runner”** (M)
   - Команда/режим: заспавнить X сущностей, включить roam event, выдать предметы.
   - Где: `src/game_debug_controls.h`, `tests/*`.

2. **Сохранение настроек/прогресса расширить** (S/M)
   - Больше значений, версия сейва.
   - Где: `src/progression.h`, `src/session.h`.

---

### Быстрые задачи на 30–60 минут (выбрать и пилить)

- (S) Мед-спрей предмет.
- (S) Ложные пики сканера при низкой sanity.
- (S) Пинг метка в коопе.
- (M) Слух для Crawler.
- (M) Перегрев сканера.

---

### Ограничения проекта

- Лимит: **500 строк на файл** (проверяется билдом).
- Многие `*.h` включаются в единственный TU (`game.cpp`), поэтому аккуратно с includes/зависимостями.
---

## Последние правки (changelog / заметки)

- [x] **Held items / viewmodel**: добавлены отдельные модели для фонаря, сканера, батарейки и плюша.
- [x] **Slot 3**: теперь экипает расходник (battery/plush) в руку и показывает модель; повторное нажатие использует.
- [x] **Flashlight light origin**: добавлен `flashPos` и перенесён источник света с камеры на позицию фонарика.
- [ ] **TODO**: довести позиционирование предметов в руках до приятного вида (оффсеты/анимации по вкусу).
